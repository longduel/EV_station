#:kivy 2.1.0
#:import MapView kivy_garden.mapview
#:import GpsBlinker gps_blinker.GpsBlinker
#:include gps_blinker.kv
# Root widgets they need to be first so the ScreenManger can load them in
WindowManager:
    MainWindow
    MapWindow
    NewStationWindow
    StationWindow
    AboutWindow
    SearchStation

<StationWindow>
    #REMOVE CLASS WHEN DONE!!!!!!!!!!
    name: "station"
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        #size_hint: (0.5, 0.5)
        #pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: 1000
            BoxLayout:
                orientation: "horizontal"
                MDLabel:
                    id: calc_input
                    text: "STATION MAP"
                    font_size: "20sp"
                    font_name: "assets/fonts/Poppins-Regular.ttf"
                    pos_hint: {"x": 0.3, "y": 0.44}
                Label:
                    id: station_text
                    text: "check SQL"
                    color: (0,1,0,1)
                Button:
                MDCard:
                    size_hint: .8, .55
                    pos_hint: {"center_x": 0.5, "center_y": 0.55}
                    elevation: 1
                    md_bg_color: "lightgreen"
                    padding: 25
                    spacing: 25
                    orientation: "vertical"
                    Label:
                        id: station_text
                        text: "check SQL"
                        color: (0,1,0,1)
            MDCard:
                size_hint: .8, .55
                pos_hint: {"center_x": 0.5, "center_y": 0.55}
                elevation: 1
                #md_bg_color: "lightgreen"
                padding: 25
                spacing: 25
                orientation: "vertical"
                #on_release: root.get_name()

<MainWindow>:
    name: "main" # defines the window id for ScreenManager
    FloatLayout:
        # Setting up the custom background image
        Image:
            source: 'assets/image/Scroll Group 1.png'
            size_hint: None, None
            pos: self.pos
            size: root.size
            keep_ratio: False
            allow_stretch: True

        # Top Page Image
        Image:
            source: 'assets/image/Top1.png'
            pos_hint: {"center_y": 0.9}
        # First Button Image
        Image:
            source: 'assets/image/Button.png'
            pos_hint: {"center_y": 0.62}

        MDRectangleFlatIconButton:
            id: station_map
            text: "STATION MAP"
            font_size: "20sp"
            font_name: "assets/fonts/Geddes_Bold.otf"
            icon: "lightning-bolt"
            line_color: 0, 0, 0, 0
            pos_hint: {"center_x": 0.5, "center_y": 0.63}
            on_release:
                app.root.current = "map"
                root.manager.transition.direction = "left"

        # Second Button Image
        Image:
            source: 'assets/image/Button.png'
            pos_hint: {"center_y": 0.42}

        MDRectangleFlatIconButton:
            id: new_station
            text: "NEW STATION"
            font_size: "20sp"
            font_name: "assets/fonts/Geddes_Bold.otf"
            icon: "map-plus"
            line_color: 0, 0, 0, 0
            pos_hint: {"center_x": 0.5, "center_y": 0.43}
            on_release:
                app.root.current = "new_station"
                root.manager.transition.direction = "left"

        # Bottom Page Image
        Image:
            source: 'assets/image/Bottom1.png'
            pos_hint: {"center_y": 0.12}
            #size: {10, 10}

        MDLabel:
            text: "ev lodz"
            font_size: "30sp"
            halign: "center"
            font_name: "assets/fonts/Nonchalance_R.otf"
            pos_hint: {"center_y": 0.94}

        MDIconButton:
            icon: "information-outline"
            icon_size: "40sp"
            pos_hint: {"center_x": 0.9, "center_y": 0.94}
            on_release:
                app.root.current = "about"
                root.manager.transition.direction = "up"

<MapWindow>:
    name: "map" # defines the window id for ScreenManager
    on_pre_enter:
        root.centers_map()

    size_hint: None, None
    size: root.get_size()

    lat: 51.759445
    lon: 19.457216
    zoom: 10

    double_tap_zoom: True
    snap_to_zoom: False
    on_zoom:
        self.zoom = 10 if self.zoom < 10 else self.zoom
    on_lat:
        root.set_station_markers()
    on_lon:
        root.set_station_markers()

    GpsBlinker:
        lat: root.lat
        lon: root.lon
        id: blinker

    Image:
        source: 'assets/image/Map_top.png'
        pos_hint: {"y": 0.45}
        #size_hint_x: -0.3
        #size_hint_y: 1.2
        allow_stretch: True

    MDLabel:
        id: calc_input
        text: "STATION MAP"
        font_size: "20sp"
        font_name: "assets/fonts/Poppins-Regular.ttf"
        pos_hint: {"x": 0.3, "y": 0.44}

    MDIconButton:
        icon: "assets/image/arrow_back.png"
        icon_size: "40sp"
        icon_color: app.theme_cls.primary_color
        pos_hint: {"center_x": .12, "center_y": .94}
        on_release:
            app.root.current = "main"
            root.manager.transition.direction = "right"

    MDIconButton:
        icon: "magnify"
        icon_size: "40sp"
        icon_color: app.theme_cls.primary_color
        pos_hint: {"center_x": .90, "center_y": .94}
        on_release:
            root.search_stations()

    MDIconButton:
        icon: "assets/image/GPS_icon.png"
        icon_size: "60sp"
        pos_hint: {"center_x": 0.87, "center_y": 0.11}
        on_release:
            root.center_on_gps_location()

<SearchStation>
    name: "search_station" # defines the window id for ScreenManager
    FloatLayout:
        # Setting up the custom background image
        Image:
            source: 'assets/image/Scroll Group 1.png'
            size_hint: None, None
            pos: self.pos
            size: root.size
            keep_ratio: False
            allow_stretch: True
        Image:
            source: 'assets/image/Map_top.png'
            pos_hint: {"y": 0.45}
            #size_hint_x: -0.3
            #size_hint_y: 1.2
            allow_stretch: True

        MDIconButton:
            icon: "assets/image/arrow_back.png"
            icon_size: "40sp"
            icon_color: app.theme_cls.primary_color
            pos_hint: {"center_x": .12, "center_y": .94}
            on_release:
                app.root.current = "main"
                root.manager.transition.direction = "right"
                root.refresh()

        MDTextField:
            id: text_field_error
            hint_text: "Helper text on error (press 'Enter')"
            helper_text: "There will always be a mistake"
            helper_text_mode: "on_error"
            pos_hint: {"center_x": .3, "center_y": .82}
            size_hint_x: .5

<NewStationWindow>
    name: "new_station"

    FloatLayout:

        Image:
            source: 'assets/image/Scroll Group 1.png'
            size_hint: None, None
            pos: self.pos
            size: root.size
            keep_ratio: False
            allow_stretch: True
        Image:
            source: 'assets/image/Map_top.png'
            pos_hint: {"y": 0.45}
            allow_stretch: True
        MDLabel:
            text: "Feel free to contact us or \nrequest a new station."
            font_size: "15sp"
            font_name: "assets/fonts/Poppins-Regular.ttf"
            pos_hint: {"x": 0.25, "y": 0.44}

        MDIconButton:
            icon: "assets/image/arrow_back.png"
            icon_size: "40sp"
            icon_color: app.theme_cls.primary_color
            pos_hint: {"center_x": .12, "center_y": .94}
            on_release:
                app.root.current = "main"
                root.manager.transition.direction = "right"
                root.refresh()
        Label:
            text: "Full Name:"
            font_size: 16
            font_name: "assets/fonts/Poppins-Regular.ttf"
            color: (229,137,30,1)
            pos_hint: {'center_x': 0.18, 'center_y': 0.84}
        TextInput:
            id: full_name
            multiline: False
            pos_hint: {'center_x': 0.5, 'center_y': 0.78}
            size_hint: .9, .08
        Label:
            text: "Email:"
            font_size: 16
            font_name: "assets/fonts/Poppins-Regular.ttf"
            color: (229,137,30,1)
            pos_hint: {'center_x': 0.12, 'center_y': 0.71}
        TextInput:
            id: email
            multiline: False
            pos_hint: {'center_x': 0.5, 'center_y': 0.65}
            size_hint: .9, .08
        Spinner:
            id: spinner_id
            text: "Pick Query"
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
            size_hint: .9, .08
            values: ['Report New Station', 'Problem With App', 'Other']

        Label:
            text: "Additional Notes:"
            font_size: 16
            font_name: "assets/fonts/Poppins-Regular.ttf"
            color: (229,137,30,1)
            pos_hint: {'center_x': 0.26, 'center_y': 0.48}
        TextInput:
            id: additional_notes
            multiline: True
            pos_hint: {'center_x': 0.5, 'center_y': 0.33}
            size_hint: .92, .25

        MDRectangleFlatIconButton:
            id: add_attachment
            text: "Send\nRequest"
            font_size: "20sp"
            font_name: "assets/fonts/Geddes_Bold.otf"
            icon: "gmail"
            line_color: 0, 0, 0, 0
            pos_hint: {"center_x": 0.46, "center_y": 0.13}
            on_release:
                root.send_email_button()



<AboutWindow>:
    name: "about" # defines the window id for ScreenManager

    FloatLayout:
        # Setting up the custom background image
        Image:
            source: 'assets/image/Scroll Group 1.png'
            size_hint: None, None
            pos: self.pos
            size: root.size
            keep_ratio: False
            allow_stretch: True
        Image:
            source: 'assets/image/Map_top.png'
            pos_hint: {"y": 0.45}
            #size_hint_x: -0.3
            #size_hint_y: 1.2
            allow_stretch: True

        MDIconButton:
            icon: "assets/image/arrow_back.png"
            icon_size: "40sp"
            icon_color: app.theme_cls.primary_color
            pos_hint: {"center_x": .12, "center_y": .94}
            on_release:
                app.root.current = "main"
                root.manager.transition.direction = "up"

        MDLabel:
            text: "ABOUT THIS PROJECT"
            font_size: "20sp"
            font_name: "assets/fonts/NotoSansSymbols-VariableFont_wght.ttf"
            pos_hint: {"x": 0.18, "y": 0.445}

        MDCard:
            size_hint: .8, .45
            pos_hint: {"center_x": 0.5, "center_y": 0.6}
            elevation: 1
            md_bg_color: "lightgreen"
            padding: 25
            spacing: 25
            orientation: "vertical"

            MDLabel:
                markup: True
                text: "[i]Application with a map of the electric vehicle charging stations available within the Polish city of Lodz.[/i]"
                font_size: "13sp"
                halign: 'center'
                #font_name: "assets/fonts/Poppins-Regular.ttf"
                size_hint: (1, 0.3)
                pos_hint: {"center_x": 0.5, "center_y": 0.6}

            MDLabel:
                text: "This piece of software was based on the cross-platform GUI framework Kivy for Python language, created as a part of the engineering thesis."
                font_size: "10sp"
                halign: 'left'
                font_name: "assets/fonts/Poppins-Regular.ttf"
                size_hint: (1, 0.5)
                #pos_hint: {"center_x": 0.2, "center_y": 0.5}

            MDSeparator:

            MDLabel:
                text: "© 2023"
                font_size: "10sp"
                size_hint: (0.2, 0.05)
                font_name: "assets/fonts/NotoSansSymbols-VariableFont_wght.ttf"
                pos_hint: {"center_x": 0.5, "center_y": 0.5}

        MDIconButton:
            icon: 'assets/image/Githubicon.png'
            icon_size: "70sp"
            pos_hint: {"center_x": 0.65, "center_y": 0.28}
            on_release:
                webbrowser.open('https://github.com/longduel')

        MDIconButton:
            icon: 'assets/image/Gmailicon.png'
            icon_size: "70sp"
            pos_hint: {"center_x": 0.35, "center_y": 0.28}
            on_release:
                root.show_contact_details()

        Image:
            source: 'assets/image/Bottom1.png'
            pos_hint: {"center_y": 0.12}
            #size: {10, 10}